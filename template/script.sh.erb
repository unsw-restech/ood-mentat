#!/bin/bash

# Clean the environment
module purge

#
# Launch Xfce Window Manager and Panel
#

(
    export SEND_256_COLORS_TO_REMOTE=1
    export XDG_CONFIG_HOME="<%= session.staged_root.join("config") %>"
    export XDG_DATA_HOME="<%= session.staged_root.join("share") %>"
    export XDG_CACHE_HOME="$(mktemp -d)"
    module restore
    set -x
    xfwm4 --compositor=off --daemon --sm-client-disable
    xsetroot -solid "#D3D3D3"
    xfsettingsd --sm-client-disable
    xfce4-panel --sm-client-disable
) &

# Set working directory to home directory
cd "${HOME}"

#
# Start Marc Mentat
#

case <%= context.version %> in
    mentat/2018.1)
	module load intelmpi/2019.5.281
	;;
    mentat/2019.1)
	module load intelmpi/2019.6.166
	;;
    *)
	echo "Unknown version of Marc Mentat.  Please contact <itservicecentre@unsw.edu.au> with this error message." 1>&2
	exit 1
	;;
esac

module load <%= context.version %>

module list
set -x

sleep 5				# Allow time for NoVNC to maximise correctly
mentat -maximize
